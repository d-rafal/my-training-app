"use strict";(self.webpackChunkmy_training_app=self.webpackChunkmy_training_app||[]).push([[849],{7672:function(e,n,t){var r=t(2791),i=t(6313);n.Z=function(e){var n=(0,i.QB)();return(0,r.useEffect)((function(){n(e)})),null}},8016:function(e,n,t){t.r(n),t.d(n,{default:function(){return He}});var r=t(3967),i=t(5193),a=t(8870),s=t(890),o=t(3767),l=t(1413),c=t(9439),d=t(1333),u=t(6563),x=t(3504),f=t(2829),m=function(e,n,t){if("string"!==typeof e)throw new Error("typeof param 'originalQuery' in 'updateUrlQuery' function different than 'string'");if("string"!==typeof n)throw new Error("typeof param 'queryKey' in 'updateUrlQuery' function different than 'string'");if(t&&"string"!==typeof t)throw new Error("typeof param 'newKeyValue' in 'updateUrlQuery' function different than 'string'");var r="";if(n)if(t){var i=new RegExp("".concat(n,"=[^&]*"),"g");if(null!==e.match(i)){var a=new RegExp("(".concat(n,"=)[^&]*"),"g");r=e.replace(a,"$1".concat(t))}else r=""===e||"?"===e?"?".concat(n,"=").concat(t):e+"&".concat(n,"=").concat(t)}else{var s=new RegExp("(&|\\?)?".concat(n,"=[^&]*(&?)"),"g");r=e.replace(s,(function(e,n,t){return"?"!==n&&""!==n&&void 0!==n||"&"!==t?"&"===n&&"&"===t?"&":"":"?"}))}else r=e;return r.length&&("?"===r?r="":"?"!==r[0]&&(r="?"+r)),r},g=t(6872),h=t(1933),Z=t(1221),p=t(3694),j=function(e,n){var t=(0,p.k)();return(0,h.useQuery)(["trainings",{search:e}],(function(e){var n=e.queryKey,t=e.signal;return Z.Z.trainings.getTrainings(n[1].search,t).then((function(e){return e}),(function(e){throw e}))}),(0,l.Z)({refetchOnWindowFocus:!1,useErrorBoundary:!1,onError:function(e){console.error("Failed to fetch trainings:",e),t("Failed to fetch trainings","error",void 0,!0)}},n))},v=t(184),y=function(){var e=(0,x.lr)(),n=(0,c.Z)(e,1)[0],t=j(n.toString(),{select:function(e){return e.body.numberOfPages},keepPreviousData:!0,enabled:!1,notifyOnChangeProps:["data"]}).data,r=(0,f.Z)(n.get(g.eB.page));return(null===r||r<=0)&&(r=1),(0,v.jsx)(d.Z,{size:"small",page:r,count:t||1,color:"primary",siblingCount:1,renderItem:function(e){var t=m(n.toString(),g.eB.page,String(e.page));return(0,v.jsx)(u.Z,(0,l.Z)((0,l.Z)({},e),{},{component:x.rU,to:t}))}})},S=t(5861),b=t(5987),w=t(7757),C=t.n(w),D=t(3099),k=t(3400),E=t(7391),I=t(6151),F=function(e){var n=e.getFullYear(),t=e.getMonth()+1,r=e.getDate(),i=String(n),a=String(t);a.length<2&&(a="0"+a);var s=String(r);return s.length<2&&(s="0"+s),"".concat(i,"-").concat(a,"-").concat(s)},T=function(e){return e instanceof Date&&!Number.isNaN(Number(e))},L=t(22),_=t(2791),V=t(1134),B=["field","fieldState"],M=new Date(Date.UTC(2e3,1,1,0,0,0)),Q=function(e){var n=e.removeFilterByDateFromUrl,t=e.reset;return(0,v.jsx)(k.Z,{type:"button","aria-label":"clear filter",onClick:function(){t(),n()},children:(0,v.jsx)(L.Z,{sx:{fontSize:"3rem"}})})},q=function(e,n){return(0,_.useEffect)((function(){var t=function(e,t){var r=function(e){var n=e.match(/(\d{4})-(\d{2})-(\d{2})/);return new Date(Number(null===n||void 0===n?void 0:n[1]),Number(null===n||void 0===n?void 0:n[2])-1,Number(null===n||void 0===n?void 0:n[3]))}(e);T(r)&&n(t,r,{shouldValidate:!0})};if(e){var r=e.match(/from-(\d{4}-\d{2}-\d{2})-to-(\d{4}-\d{2}-\d{2})/);null!==r&&void 0!==r&&r[1]&&t(r[1],"start-date"),null!==r&&void 0!==r&&r[2]&&t(r[2],"end-date")}else n("start-date",null),n("end-date",null)}),[e]),null},N={validDate:function(e){return!!e&&T(e)||"Enter valid date"},notFutureDate:function(e){return!!e&&e<new Date||"Future date not allowed"},notBeforeMinAllowedDate:function(e){return!!e&&e>M||"Date before ".concat(M.toLocaleString("pl-PL",{timeZone:"UTC"}).split(",")[0])}};function P(e){var n=e.field,t=e.fieldState,r=(0,b.Z)(e,B);return(0,v.jsx)(D.M,(0,l.Z)({mask:"__.__.____",disableFuture:!0,allowSameDateSelection:!0,openTo:"month",views:["year","month","day"],minDate:M,value:n.value,onChange:n.onChange,inputRef:n.ref,renderInput:function(e){var r;return(0,v.jsx)(E.Z,(0,l.Z)((0,l.Z)({},e),{},{name:n.name,variant:"standard",error:t.invalid,helperText:t.invalid?null===(r=t.error)||void 0===r?void 0:r.message:" ",onBlur:n.onBlur}))}},r))}var A=function(){var e=(0,r.Z)(),n=(0,i.Z)(e.breakpoints.down("sm"),{noSsr:!0}),t=(0,x.lr)(),s=(0,c.Z)(t,2),d=s[0],u=s[1],f=(0,V.cI)({defaultValues:{"start-date":null,"end-date":null},mode:"all",criteriaMode:"firstError",shouldUnregister:!0}),h=f.handleSubmit,Z=f.reset,p=f.setValue,j=f.control,y=(0,f.watch)("start-date"),b=d.get(g.eB.filterByDate);q(b,p);var w=function(){var e=(0,S.Z)(C().mark((function e(n){var t,r,i;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{t=n["start-date"],r=n["end-date"],i=m(d.toString(),g.eB.filterByDate,"from-"+F(t)+"-to-"+F(r)),u(i)}finally{}case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,v.jsx)(a.Z,{sx:{pt:"0.0rem",flexGrow:0},children:(0,v.jsx)("form",{noValidate:!0,onSubmit:h(w),children:(0,v.jsxs)(o.Z,{spacing:n?1:3,direction:n?"column":"row",alignItems:"center",justifyContent:"center",sx:{flexWrap:"wrap"},children:[(0,v.jsx)(V.Qr,{render:function(e){var n=e.field,t=e.fieldState;e.formState;return(0,v.jsx)(P,{field:n,fieldState:t,label:"Start date"})},name:"start-date",control:j,rules:{validate:(0,l.Z)({},N)}}),(0,v.jsx)(V.Qr,{render:function(e){var n=e.field,t=e.fieldState;e.formState;return(0,v.jsx)(P,{field:n,fieldState:t,label:"End date"})},name:"end-date",control:j,rules:{validate:(0,l.Z)((0,l.Z)({},N),{},{afterStartDate:function(e){return null!==e&&null!==y&&e>y||"End date after start date"}})}}),(0,v.jsxs)(a.Z,{children:[(0,v.jsx)(I.Z,{type:"submit",size:"large",variant:"outlined",children:"Filter"}),d.get(g.eB.filterByDate)?(0,v.jsx)(Q,{removeFilterByDateFromUrl:function(){u(m(d.toString(),g.eB.filterByDate))},reset:Z}):null]})]})})})},z=t(3433),U=t(5855),W=t(3449),R=function(e){var n=e.element,t=e.index;return(0,v.jsxs)(U.Z,{children:[(0,v.jsx)(W.Z,{children:t+1}),(0,v.jsx)(W.Z,{children:n.load&&"-"!==n.load?n.load:"-"}),(0,v.jsx)(W.Z,{children:n.quantity})]})},O=t(7630),H=t(1478),K=t(1055),Y=t(5818),$=t(3721),G=(0,O.ZP)((function(e){return(0,v.jsx)(K.Z,(0,l.Z)({elevation:2,square:!0},e))}))((function(e){var n=e.theme;return{border:"1px solid ".concat(n.palette.divider),"&:not(:last-child)":{},"&:before":{display:"none"}}})),J=(0,O.ZP)((function(e){return(0,v.jsx)(Y.Z,(0,l.Z)({expandIcon:(0,v.jsx)(H.Z,{sx:{fontSize:"0.9rem"}})},e))}))((function(e){return{backgroundColor:"dark"===e.theme.palette.mode?"rgba(255, 255, 255, .05)":"rgba(0, 0, 0, .03)",flexDirection:"row-reverse"}})),X=(0,O.ZP)($.Z)((function(e){return{padding:e.theme.spacing(2),borderTop:"1px solid rgba(0, 0, 0, .125)"}})),ee=t(1131),ne=function(e){var n=e.summaryId,t=e.summaryText,r=e.summaryIcons,i=e.children,a=(0,_.useState)(!1),l=(0,c.Z)(a,2),d=l[0],u=l[1];return(0,v.jsxs)(G,{TransitionProps:{unmountOnExit:!0},expanded:d,onChange:function(){return u((function(e){return!e}))},sx:{maxWidth:"100%","& .MuiAccordionSummary-content":{maxWidth:"calc(100% - 24px)"}},children:[(0,v.jsx)(J,{"aria-controls":n,id:n,expandIcon:(0,v.jsx)(ee.Z,{}),sx:{},children:(0,v.jsxs)(o.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{maxWidth:"100%"},flexGrow:1,children:[(0,v.jsx)(s.Z,{sx:{textOverflow:"ellipsis",overflow:"hidden"},children:t}),r]})}),(0,v.jsx)(X,{children:i})]})},te=t(1161),re=t(2207),ie=t(9281),ae=t(6890),se=t(7488),oe=t(5574),le=t(5661),ce=t(9157),de=t(1691),ue=t(7123),xe=t(3239),fe=t(6871),me=t(2898),ge=t(7247),he=t(2419),Ze=t(1286),pe=t(7456),je=function(e){var n=e.exercise,t=e.training_id,r=e.exerciseIndex,i=e.exercises,o=e.setExerciseDialogState,l=n.series.map((function(e){return e.quantity})).join(", "),d=(0,_.useState)(!1),u=(0,c.Z)(d,2),f=u[0],m=u[1],g=(0,fe.TH)(),j=(0,x.lr)(),y=(0,c.Z)(j,1)[0],S=(0,p.k)(),b=(0,h.useQueryClient)(),w=(0,pe.Z)(),C=(0,h.useMutation)((function(){var e=(0,z.Z)(i);return e.splice(r,1),Z.Z.trainings.updateExercises(t,e,g.search).then((function(e){return e}),(function(e){throw e}))}),{onSuccess:function(e,n,t){w&&b.setQueryData(["trainings",{search:y.toString()}],e),S("Exercise deleted","info")},onError:function(e,n,t){console.error("Failed to add exercise:",e),S("Failed to add exercise","error",void 0,!0)},onSettled:function(e,n,t,r){k()}}),D="exercise_".concat(n._id),k=function(){m(!1)};return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(ne,{summaryId:D,summaryText:"".concat(n.name,": [").concat(l.length?l:"no series","]"),summaryIcons:(0,v.jsx)(a.Z,{sx:{position:"relative",width:"5rem"},onClick:function(e){return e.stopPropagation()},children:(0,v.jsxs)(te.Z,{ariaLabel:"Edit options",direction:"left",FabProps:{size:"small",color:"primary"},sx:{position:"absolute",top:"0px",right:"0px",transform:"translateY(-50%)","& .MuiButtonBase-root":{width:"2rem",height:"2rem",minHeight:"unset"}},icon:(0,v.jsx)(me.Z,{}),children:[(0,v.jsx)(re.Z,{icon:(0,v.jsx)(ge.Z,{}),tooltipTitle:"Delete exercise",onClick:function(e){m(!0)}}),(0,v.jsx)(re.Z,{icon:(0,v.jsx)(he.Z,{}),tooltipTitle:"Add exercise",onClick:function(){o({open:!0,index:r})}}),(0,v.jsx)(re.Z,{icon:(0,v.jsx)(Ze.Z,{}),tooltipTitle:"Edit exercise",onClick:function(){o({open:!0,index:r,initialValues:n})}})]})}),children:(0,v.jsxs)(ie.Z,{component:"table",sx:{"& .MuiTableCell-root":{pl:"0.25rem",pr:"0.25rem",textAlign:"center"}},children:[(0,v.jsx)(ae.Z,{children:(0,v.jsxs)(U.Z,{children:[(0,v.jsx)(W.Z,{children:(0,v.jsx)(s.Z,{children:"Nr"})}),(0,v.jsx)(W.Z,{children:(0,v.jsx)(s.Z,{children:"Load\xa0(kg)"})}),(0,v.jsx)(W.Z,{children:(0,v.jsx)(s.Z,{children:"Quantity"})})]})}),(0,v.jsx)(se.Z,{children:n.series.map((function(e,n){return(0,v.jsx)(R,{element:e,index:n},e._id)}))})]})}),(0,v.jsxs)(oe.Z,{open:f,onClose:k,"aria-labelledby":"delete-exercise-dialog-title","aria-describedby":"delete-exercise-dialog-description",children:[(0,v.jsx)(le.Z,{id:"delete-exercise-dialog-title",children:"Delete exercise confirmation"}),(0,v.jsx)(ce.Z,{children:(0,v.jsxs)(de.Z,{id:"delete-exercise-dialog-description",children:["Do you really want to delete exercise"," ",(0,v.jsx)("strong",{children:n.name}),"?"]})}),(0,v.jsxs)(ue.Z,{children:[(0,v.jsx)(I.Z,{onClick:k,children:"No"}),(0,v.jsxs)(I.Z,{onClick:function(){C.mutate()},autoFocus:!0,disabled:C.isLoading,children:[C.isLoading&&(0,v.jsx)(xe.Z,{size:24,sx:{mr:"0.5rem"}}),"Yes"]})]})]})]})},ve=t(1889),ye=function(e){var n=e.onClick;return(0,v.jsx)(k.Z,{"aria-label":"delete",onClick:n,children:(0,v.jsx)(ge.Z,{})})},Se=t(9276),be=t(9823),we=t(3880),Ce=t(5984),De=function(e){var n=e.trigger,t=e.triggerNewSeriesValidation,r=e.indexForValidationTrigger;return(0,_.useEffect)((function(){null!==r&&n("series.".concat(r,".quantity"),{})}),[t,r,n]),(0,_.useEffect)((function(){n()}),[]),null},ke=function(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(e.target.value.match(/^\d*$/)||r&&"-"===e.target.value)&&n(t,e.target.value,{shouldValidate:!0})},Ee=function(e){var n=e.exerciseDialogState,t=e.setExerciseDialogState,r=e.trainingSession,i=(0,p.k)(),a=(0,fe.TH)(),d=(0,x.lr)(),u=(0,c.Z)(d,1)[0],f=(0,_.useRef)(!1),m=(0,_.useState)(null),g=(0,c.Z)(m,2),j=g[0],y=g[1],b=(0,_.useState)(!1),w=(0,c.Z)(b,2),D=w[0],F=w[1],T=(0,pe.Z)(),L=(0,h.useQueryClient)(),B=(0,h.useMutation)((function(e){return Z.Z.trainings.updateExercises(null!==r&&void 0!==r&&r._id?r._id:"",e,a.search).then((function(e){return e}),(function(e){throw e}))}),{onSuccess:function(e,t,r){T&&L.setQueryData(["trainings",{search:u.toString()}],e),i(n.initialValues?"Exercise Updated":"Exercise Added","success")},onError:function(e,n,t){console.error("Failed to add exercise:",e),i("Failed to add exercise","error",void 0,!0)},onSettled:function(e,n,t,r){X()}}),M=(0,V.cI)({defaultValues:n.initialValues?{name:n.initialValues.name,comment:n.initialValues.comment,series:n.initialValues.series.reduce((function(e,n){return e.concat([{key:(0,Ce.x0)(),load:n.load,quantity:n.quantity}])}),[])}:{name:"",comment:"",series:[]},mode:"all",criteriaMode:"firstError",shouldUnregister:!0}),Q=M.handleSubmit,q=M.setValue,N=M.control,P=M.trigger,A=M.formState,R=A.isSubmitting,O=A.isValid,H=(0,V.Dq)({control:N,name:"series",shouldUnregister:!0}),K=H.fields,Y=H.append,$=H.remove,G=H.insert,J=function(){var e=(0,S.Z)(C().mark((function e(t){var i,a,s,o,c,d,u;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f.current){e.next=10;break}return f.current=!0,e.prev=2,(u=(0,z.Z)(null!==(i=null===r||void 0===r?void 0:r.exercises)&&void 0!==i?i:[])).splice((null!==(a=n.index)&&void 0!==a?a:null===r||void 0===r?void 0:r.exercises.length)||0,n.initialValues?1:0,(0,l.Z)((0,l.Z)({},null!==n&&void 0!==n&&null!==(s=n.initialValues)&&void 0!==s&&s._id?{_id:n.initialValues._id}:void 0),{},{name:null!==(o=t.name)&&void 0!==o?o:"",comment:null!==(c=t.comment)&&void 0!==c?c:"",series:null!==(d=t.series.reduce((function(e,n){return e.concat([{load:"-"!==n.load&&n.load?n.load:0,quantity:n.quantity?n.quantity:0}])}),[]))&&void 0!==d?d:[]})),e.next=7,B.mutateAsync(u);case 7:return e.prev=7,f.current=!1,e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[2,,7,10]])})));return function(n){return e.apply(this,arguments)}}(),X=function(){t({open:!1})};return(0,v.jsxs)(oe.Z,{open:n.open,onClose:X,scroll:"paper","aria-labelledby":"add-edit-exercise-dialog-title",sx:{margin:"0rem"},children:[(0,v.jsxs)(le.Z,{id:"add-edit-exercise-dialog-title",children:[n.initialValues?"Update Exercise":"Add Exercise",(0,v.jsx)(k.Z,{"aria-label":"close",onClick:X,sx:{position:"absolute",right:8,top:8,color:function(e){return e.palette.grey[500]}},children:(0,v.jsx)(be.Z,{})})]}),(0,v.jsxs)("form",{noValidate:!0,autoComplete:"off",onSubmit:Q(J),children:[(0,v.jsxs)(ce.Z,{dividers:!0,sx:{opacity:B.isLoading?.5:1},children:[(0,v.jsxs)(o.Z,{spacing:0,direction:"column",alignItems:"center",children:[(0,v.jsx)(V.Qr,{render:function(e){var n=e.field,t=e.fieldState;e.formState;return(0,v.jsx)(E.Z,(0,l.Z)({id:"name",margin:"dense",fullWidth:!0,label:"Exercise name",variant:"filled",inputProps:{maxLength:100},autoFocus:!0},(0,we.d)(n,t)))},name:"name",control:N,rules:{required:"Required",maxLength:{value:100,message:"Max length is ".concat(100," characters")}}}),(0,v.jsx)(V.Qr,{render:function(e){var n=e.field,t=e.fieldState;e.formState;return(0,v.jsx)(E.Z,(0,l.Z)({id:"comment",margin:"dense",fullWidth:!0,label:"Exercise comment",multiline:!0,variant:"filled",inputProps:{maxLength:255}},(0,we.d)(n,t)))},name:"comment",control:N,rules:{maxLength:{value:255,message:"Max length is ".concat(255," characters")}}}),K&&K.length>0?(0,v.jsx)(o.Z,{children:(0,v.jsxs)(ie.Z,{component:"table",sx:{"& .MuiTableCell-root":{padding:"0 0.25rem",textAlign:"center"},"& .MuiTableCell-body":{padding:"0.4rem 0.25rem"}},children:[(0,v.jsx)(ae.Z,{children:(0,v.jsxs)(U.Z,{children:[(0,v.jsx)(W.Z,{}),(0,v.jsx)(W.Z,{children:"Nr"}),(0,v.jsx)(W.Z,{children:"Load\xa0(kg)"}),(0,v.jsx)(W.Z,{children:"Quantity"}),(0,v.jsx)(W.Z,{})]})}),(0,v.jsx)(se.Z,{children:K.map((function(e,n){return(0,v.jsxs)(U.Z,{children:[(0,v.jsx)(W.Z,{children:(0,v.jsx)(k.Z,{type:"button","aria-label":"delete series",onClick:function(){return $(n)},children:(0,v.jsx)(ge.Z,{})})}),(0,v.jsx)(W.Z,{children:(0,v.jsxs)(s.Z,{variant:"h5",children:[" ",n+1]})}),(0,v.jsx)(W.Z,{children:(0,v.jsx)(V.Qr,{render:function(e){var n=e.field,t=e.fieldState;e.formState;return(0,v.jsx)(E.Z,(0,l.Z)((0,l.Z)({hiddenLabel:!0,size:"small",required:!0,variant:"filled",inputProps:{maxLength:3},sx:{width:"3.5rem",transform:"translateY(0.7rem)","& .MuiFormHelperText-root":{ml:"0.1rem",mt:"0.1rem"},"& .MuiFilledInput-input":{textAlign:"center"}}},(0,we.d)(n,t)),{},{onChange:function(e){ke(e,q,n.name,!0)}}))},name:"series.".concat(n,".load"),control:N,rules:{validate:{inAllowRange:function(e){if("-"!==e){var n=Number(e);if(Number.isNaN(n)||n<0||n>999)return"<0,999>"}return!0}}}})}),(0,v.jsx)(W.Z,{children:(0,v.jsx)(V.Qr,{render:function(e){var n=e.field,t=e.fieldState;e.formState;return(0,v.jsx)(E.Z,(0,l.Z)((0,l.Z)({hiddenLabel:!0,size:"small",required:!0,variant:"filled",inputProps:{maxLength:3},sx:{width:"3.5rem",transform:"translateY(0.7rem)","& .MuiFormHelperText-root":{ml:"0.1rem",mt:"0.1rem"},"& .MuiFilledInput-input":{textAlign:"center"}}},(0,we.d)(n,t)),{},{onChange:function(e){ke(e,q,n.name,!1)}}))},name:"series.".concat(n,".quantity"),control:N,rules:{required:"Required",validate:{inAllowRange:function(e){var n=Number(e);return!(Number.isNaN(n)||n<1||n>999)||"<1,999>"}}}})}),(0,v.jsx)(W.Z,{children:(0,v.jsx)(k.Z,{type:"button","aria-label":"add series",onClick:function(){G(n,{key:(0,Ce.x0)(),load:"",quantity:""}),y(n),F((function(e){return!e}))},children:(0,v.jsx)(he.Z,{})})})]},e.id)}))})]})}):void 0,(0,v.jsx)(I.Z,{type:"button",variant:"outlined",startIcon:(0,v.jsx)(he.Z,{}),onClick:function(){Y({key:(0,Ce.x0)(),load:"",quantity:""}),y(K.length),F((function(e){return!e}))},sx:{mt:K.length>0?"1.6rem":"0.4rem",mb:"0.8rem"},children:"Add series"})]}),(0,v.jsx)(De,{trigger:P,triggerNewSeriesValidation:D,indexForValidationTrigger:j})]}),(0,v.jsxs)(ue.Z,{children:[(0,v.jsx)(I.Z,{type:"button",onClick:X,children:"Cancel"}),(0,v.jsxs)(I.Z,{type:"submit",size:"large",disabled:R||!O||B.isLoading,children:[B.isLoading&&(0,v.jsx)(xe.Z,{size:24,sx:{mr:"0.5rem"}}),n.initialValues?"Update":"Add"]})]})]})]})},Ie=function(e){var n=new Date(e),t=String(n.getFullYear()),r=String(n.getMonth()+1),i=String(n.getDate()),a=String(n.getHours()),s=String(n.getMinutes()),o=function(e){return e.length<2?"0"+e:e};return r=o(r),i=o(i),a=o(a),s=o(s),"".concat(i,"-").concat(r,"-").concat(t," ").concat(a,":").concat(s)},Fe=function(e){var n=e._id,t=(0,h.useQueryClient)(),r=(0,x.lr)(),i=(0,c.Z)(r,2),a=i[0],s=i[1],o=(0,fe.TH)(),l=(0,pe.Z)(),d=j(a.toString(),{select:function(e){return e.body.trainingSessions.find((function(e){return e._id===n}))},enabled:!1,notifyOnChangeProps:["data"]}).data,u=_.useState(!1),f=(0,c.Z)(u,2),y=f[0],S=f[1],b=_.useState({open:!1}),w=(0,c.Z)(b,2),C=w[0],D=w[1],k=(0,p.k)(),E=o.search?o.search:g.rg,F=(0,h.useMutation)((function(){return Z.Z.trainings.deleteTrainingSession(n,E).then((function(e){return e}),(function(e){throw e}))}),{onSuccess:function(e,n,r){var i;if(l&&(t.setQueryData(["trainings",{search:a.toString()}],e),(null===(i=new RegExp("".concat(g.eB.page,"=([^&]*)")).exec(E))||void 0===i?void 0:i[1])!==String(e.body.currentPage))){var o=m(E,g.eB.page,String(e.body.currentPage));s(o)}t.resetQueries({predicate:function(e){return"trainings"===e.queryKey[0]&&e.queryKey[1].search!==a.toString()}}),k("Training session deleted","info")},onError:function(e,n,t){console.error("Failed to delete training session:",e),k("Failed to delete training session","error",void 0,!0)},onSettled:function(e,n,t,r){V()}}),T="session_".concat(n),L="";d&&(L=Ie(d.date));var V=function(){S(!1)};return(0,v.jsxs)(ve.ZP,{component:"li",item:!0,sx:{maxWidth:"100%"},children:[(0,v.jsxs)(ne,{summaryId:T,summaryText:L,summaryIcons:(0,v.jsx)(ye,{onClick:function(e){e.stopPropagation(),S(!0)}}),children:[null===d||void 0===d?void 0:d.exercises.map((function(e,n){return(0,v.jsx)(je,{exercise:e,training_id:d._id,exerciseIndex:n,exercises:d.exercises,setExerciseDialogState:D},e._id)})),(0,v.jsx)(Se.Z,{sx:{display:"flex",justifyContent:"center",mt:"1.5rem",mb:"0.5rem","&:first-of-type":{m:"1rem 0"}},children:(0,v.jsx)(I.Z,{variant:"outlined",startIcon:(0,v.jsx)(he.Z,{}),onClick:function(){return D({open:!0})},children:"Add Exercise"})})]}),C.open&&(0,v.jsx)(Ee,{exerciseDialogState:C,setExerciseDialogState:D,trainingSession:d}),(0,v.jsxs)(oe.Z,{open:y,onClose:V,"aria-labelledby":"delete-training-session-dialog-title","aria-describedby":"delete-training-session-dialog-description",children:[(0,v.jsx)(le.Z,{id:"delete-training-session-dialog-title",children:"Delete training confirmation"}),(0,v.jsx)(ce.Z,{children:(0,v.jsxs)(de.Z,{id:"delete-training-session-dialog-description",children:["Do you really want to delete training from"," ",(0,v.jsx)("strong",{children:d?Ie(d.date):""}),"?"]})}),(0,v.jsxs)(ue.Z,{children:[(0,v.jsx)(I.Z,{onClick:V,children:"No"}),(0,v.jsxs)(I.Z,{onClick:function(){F.mutate()},autoFocus:!0,disabled:F.isLoading,children:[F.isLoading&&(0,v.jsx)(xe.Z,{size:24,sx:{mr:"0.5rem"}}),"Yes"]})]})]})]})},Te=_.memo(Fe),Le=t(9658);var _e=function(){var e=(0,pe.Z)().data,n=(0,x.lr)(),t=(0,c.Z)(n,1)[0],r=j(t.toString(),{select:function(e){return e.body.trainingSessions.map((function(e){return e._id}))},enabled:!!e}),i=r.status,o=r.data,l=r.isFetching,d=null;if("idle"===i)d=(0,v.jsx)(a.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%"},children:(0,v.jsx)(Le.Z,{variant:"filled",severity:"info",children:"No data."})});else if("loading"===i)d=(0,v.jsxs)(a.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",minHeight:"20rem",height:"100%"},children:[(0,v.jsx)(xe.Z,{size:120,sx:{marginBottom:"1rem"}}),(0,v.jsx)(s.Z,{children:"Loading..."})]});else if("error"===i)d=(0,v.jsx)(a.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%"},children:(0,v.jsx)(Le.Z,{variant:"filled",severity:"error",children:"Operation failed, no data."})});else if("success"===i){var u=null;u=null!==o&&void 0!==o&&o.length?(0,v.jsx)(a.Z,{sx:{opacity:l?.5:1},children:(0,v.jsx)(ve.ZP,{component:"ul",container:!0,direction:"column",rowSpacing:{xs:1,sm:2,md:3},sx:{listStyle:"none","& >.MuiGrid-item":{maxWidth:"100%"}},children:null===o||void 0===o?void 0:o.map((function(e){return(0,v.jsx)(Te,{_id:e},e)}))})}):(0,v.jsx)(a.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%"},children:(0,v.jsx)(Le.Z,{variant:"filled",severity:"info",children:"No data."})}),d=(0,v.jsx)(a.Z,{sx:{position:"relative"},children:u})}return(0,v.jsx)(a.Z,{mt:"1.5rem",children:d})},Ve=t(9877),Be=function(){var e=(0,_.useState)("IDLE"),n=(0,c.Z)(e,2)[1],t=(0,fe.TH)(),r=(0,_.useState)(!1),i=(0,c.Z)(r,2),a=i[0],s=i[1],d=(0,_.useRef)(!1),u=(0,V.cI)({defaultValues:{date:new Date,comment:""},mode:"all",criteriaMode:"firstError",shouldUnregister:!0}),f=u.handleSubmit,m=u.control,g=u.formState,j=g.isValid,y=g.isSubmitting,b=(0,p.k)(),w=(0,h.useQueryClient)(),D=(0,pe.Z)(),F=(0,x.lr)(),T=(0,c.Z)(F,1)[0],L=(0,h.useMutation)((function(e){var n=e.date,r=e.comment;return Z.Z.trainings.addTrainingSession({date:n.toISOString(),comment:r,exercises:[]},t.search).then((function(e){return e}),(function(e){throw e}))}),{onSuccess:function(e,n,t){D&&(w.setQueryData(["trainings",{search:T.toString()}],e),w.resetQueries({predicate:function(e){return"trainings"===e.queryKey[0]&&e.queryKey[1].search!==T.toString()}})),b("Training session added","success")},onError:function(e,n,t){console.error("Failed to add new training session:",e),b("Failed to add new training session","error",void 0,!0)},onSettled:function(e,t,r,i){n("IDLE"),B()}}),B=function(){s(!1)},M=function(){var e=(0,S.Z)(C().mark((function e(n){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.current){e.next=9;break}return d.current=!0,e.prev=2,e.next=5,L.mutateAsync({date:n.date,comment:n.comment});case 5:return e.prev=5,d.current=!1,B(),e.finish(5);case 9:case"end":return e.stop()}}),e,null,[[2,,5,9]])})));return function(n){return e.apply(this,arguments)}}();return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Ve.Z,{size:"medium",color:"secondary","aria-label":"add training session",sx:{marginLeft:"auto"},onClick:function(){s(!0)},children:(0,v.jsx)(he.Z,{})}),(0,v.jsxs)(oe.Z,{open:a,onClose:B,scroll:"paper","aria-labelledby":"add-training-session-dialog-title",sx:{margin:"0rem"},children:[(0,v.jsxs)(le.Z,{id:"add-training-session-dialog-title",children:["Add Training Session",(0,v.jsx)(k.Z,{"aria-label":"close",onClick:B,sx:{position:"absolute",right:8,top:8,color:function(e){return e.palette.grey[500]}},children:(0,v.jsx)(be.Z,{})})]}),(0,v.jsxs)("form",{noValidate:!0,onSubmit:f(M),children:[(0,v.jsx)(ce.Z,{dividers:!0,sx:{opacity:L.isLoading?.5:1},children:(0,v.jsxs)(o.Z,{spacing:0,direction:"column",alignItems:"center",children:[(0,v.jsx)(V.Qr,{render:function(e){var n=e.field,t=e.fieldState;e.formState;return(0,v.jsx)(P,{field:n,fieldState:t})},name:"date",control:m,rules:{validate:(0,l.Z)({},N)}}),(0,v.jsx)(V.Qr,{render:function(e){var n=e.field,t=e.fieldState;e.formState;return(0,v.jsx)(E.Z,(0,l.Z)({id:"comment",margin:"normal",fullWidth:!0,label:"Comment",multiline:!0,variant:"filled",autoFocus:!0,inputProps:{maxLength:255}},(0,we.d)(n,t)))},name:"comment",control:m,rules:{maxLength:{value:255,message:"Max length is ".concat(255," characters")}}})]})}),(0,v.jsxs)(ue.Z,{children:[(0,v.jsx)(I.Z,{type:"button",onClick:B,children:"Cancel"}),(0,v.jsxs)(I.Z,{type:"submit",size:"large",disabled:y||!j||L.isLoading,children:[L.isLoading&&(0,v.jsx)(xe.Z,{size:24,sx:{mr:"0.5rem"}}),"Add"]})]})]})]})]})},Me=t(7672),Qe=t(8096),qe=t(4925),Ne=t(9321),Pe=t(3786),Ae=function(e){var n=(0,_.useState)((function(){return e})),t=(0,c.Z)(n,2),r=t[0],i=t[1];return(0,_.useLayoutEffect)((function(){r!==e&&i(e)}),[e]),[r,i]},ze=function(e){return(0,g.jr)(e,g.T4,g.D$)},Ue=function(e,n,t,r){var i=m(e.toString(),t,r);n(i=m(i,g.eB.page))},We=function(){var e=(0,x.lr)(),n=(0,c.Z)(e,2),t=n[0],r=n[1],i=ze((0,f.Z)(t.get(g.eB.items))),a=Ae(i),s=(0,c.Z)(a,2),o=s[0],l=s[1];return(0,v.jsxs)(Qe.Z,{variant:"standard",sx:{m:1,minWidth:"5rem"},children:[(0,v.jsx)(qe.Z,{id:"nr-of-items-on-page-label",children:"Show Items"}),(0,v.jsxs)(Ne.Z,{labelId:"nr-of-items-on-page-label",id:"nr-of-items-on-page",value:o,onChange:function(e){var n=ze(Number(e.target.value));l(n),Ue(t,r,g.eB.items,String(n))},label:"Show Items",children:[(0,v.jsx)(Pe.Z,{value:g.T4,children:g.T4}),(0,v.jsx)(Pe.Z,{value:g.Mt,children:g.Mt}),(0,v.jsx)(Pe.Z,{value:g.v$,children:g.v$})]})]})},Re=function(e){return(0,g.jr)(e,g.iQ,g.cv)},Oe=function(){var e=(0,x.lr)(),n=(0,c.Z)(e,2),t=n[0],r=n[1],i=Re(t.get(g.eB.sortDateOrder)),a=Ae(i),s=(0,c.Z)(a,2),o=s[0],l=s[1];return(0,v.jsxs)(Qe.Z,{variant:"standard",sx:{m:0,minWidth:120},children:[(0,v.jsx)(qe.Z,{id:"trainings-sort-order",children:"Sort"}),(0,v.jsxs)(Ne.Z,{labelId:"trainings-sort-order",id:"nr-of-items-on-page",value:o,onChange:function(e){var n=Re(e.target.value);l(n),Ue(t,r,g.eB.sortDateOrder,n)},label:"Sort",children:[(0,v.jsx)(Pe.Z,{value:"date-descending",children:"Date descending"}),(0,v.jsx)(Pe.Z,{value:"date-ascending",children:"Date ascending"})]})]})},He=function(){var e=(0,r.Z)(),n=(0,i.Z)(e.breakpoints.up("lg"),{noSsr:!0});return(0,Me.Z)("Trainings"),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(a.Z,{component:"section",children:[(0,v.jsxs)(G,{sx:{mb:3},children:[(0,v.jsx)(J,{expandIcon:(0,v.jsx)(ee.Z,{}),"aria-controls":"filter-content",id:"filter-header",children:(0,v.jsx)(s.Z,{children:"Filters"})}),(0,v.jsx)(X,{sx:{mb:{xs:"1.3rem",lg:"0.5rem"},pt:"1.5rem"},children:(0,v.jsxs)(o.Z,{direction:n?"row":"column",alignItems:n?"start":"center",justifyContent:n?"space-between":"center",spacing:5,sx:{flexWrap:"wrap"},children:[(0,v.jsx)(A,{}),(0,v.jsxs)(o.Z,{direction:"row",alignItems:"center",spacing:2,sx:{},children:[(0,v.jsx)(We,{}),(0,v.jsx)(Oe,{})]})]})})]}),(0,v.jsxs)(o.Z,{direction:"row",alignItems:"center",sx:{mt:"1rem"},children:[(0,v.jsx)(y,{}),(0,v.jsx)(Be,{})]})]}),(0,v.jsxs)(a.Z,{component:"section",sx:{maxWidth:"100%",mt:"1rem"},children:[(0,v.jsx)(s.Z,{variant:"h5",component:"h1",children:"Trainings:"}),(0,v.jsx)(_e,{})]})]})}}}]);
//# sourceMappingURL=849.28a609ee.chunk.js.map